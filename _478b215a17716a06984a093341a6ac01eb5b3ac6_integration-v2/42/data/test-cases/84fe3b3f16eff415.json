{"uid":"84fe3b3f16eff415","name":"test_ephemeral_multi","fullName":"tests.functional.adapter.test_ephemeral.TestEphemeralMultiFirebolt#test_ephemeral_multi","historyId":"9288ac85bad9c6da313e8c30dd9a9167","time":{"start":1753722425263,"stop":1753722430274,"duration":5011},"status":"failed","statusMessage":"AssertionError: assert \"CREATEFACTTA...der='Female')\" == \"CREATEDIMENS...der='Female')\"\n  - CREATEDIMENSIONTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\n  ?       ^^^^^^^^^\n  + CREATEFACTTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\n  ?       ^^^^","statusTrace":"self = <test_ephemeral.TestEphemeralMultiFirebolt object at 0x7fb624fadcd0>\nproject = <dbt.tests.fixtures.project.TestProjInfo object at 0x7fb621be3fd0>\nis_firebolt_core = False\n\n    def test_ephemeral_multi(self, project, is_firebolt_core):\n        run_dbt(['seed'])\n        results = run_dbt(['run'])\n        assert len(results) == 3\n    \n        check_relations_equal(project.adapter, ['seed', 'dependent'])\n        check_relations_equal(project.adapter, ['seed', 'double_dependent'])\n        check_relations_equal(project.adapter, ['seed', 'super_dependent'])\n        assert os.path.exists('./target/run/test/models/double_dependent.sql')\n        with open('./target/run/test/models/double_dependent.sql', 'r') as fp:\n            sql_file = fp.read()\n    \n        sql_file = re.sub(r'\\d+', '', sql_file)\n        table_type = 'DIMENSION' if not is_firebolt_core else 'FACT'\n        expected_sql = (\n            f'CREATE {table_type} TABLE IF NOT EXISTS double_dependent AS ('\n            'with __dbt__cte__base as ('\n            'select * from public.seed'\n            '),  __dbt__cte__base_copy as ('\n            'select * from __dbt__cte__base'\n            ')-- base_copy just pulls from base. Make sure the listed'\n            '-- graph of CTEs all share the same dbt_cte__base cte'\n            \"select * from __dbt__cte__base where gender = 'Male'\"\n            'union all'\n            \"select * from __dbt__cte__base_copy where gender = 'Female'\"\n            ')'\n        )\n        sql_file = ''.join(sql_file.split())\n        expected_sql = ''.join(expected_sql.split())\n>       assert sql_file == expected_sql\nE       assert \"CREATEFACTTA...der='Female')\" == \"CREATEDIMENS...der='Female')\"\nE         - CREATEDIMENSIONTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\nE         ?       ^^^^^^^^^\nE         + CREATEFACTTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\nE         ?       ^^^^\n\n/home/runner/work/dbt-firebolt/dbt-firebolt/tests/functional/adapter/test_ephemeral.py:85: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"shared_data_dir","time":{"start":1753722161799,"stop":1753722161800,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmpdir_factory","time":{"start":1753722161800,"stop":1753722161800,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_data_dir","time":{"start":1753722424954,"stop":1753722424954,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"environment","time":{"start":1753722424955,"stop":1753722424955,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_root","time":{"start":1753722424955,"stop":1753722424955,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"initialization","time":{"start":1753722424955,"stop":1753722424955,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clean_up_logging","time":{"start":1753722424955,"stop":1753722424955,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"unique_schema","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_profile_target","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_yml","time":{"start":1753722424956,"stop":1753722424958,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_root","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_config_update","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_profile_data","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"prefix","time":{"start":1753722424956,"stop":1753722424956,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logs_dir","time":{"start":1753722424958,"stop":1753722424958,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_config_update","time":{"start":1753722424958,"stop":1753722424958,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"adapter","time":{"start":1753722424958,"stop":1753722425010,"duration":52},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_project_yml","time":{"start":1753722424958,"stop":1753722424958,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_setup","time":{"start":1753722425010,"stop":1753722425258,"duration":248},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_config","time":{"start":1753722425010,"stop":1753722425010,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"seeds","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"macros","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"snapshots","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"models","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"properties","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tests","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"analyses","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"selectors","time":{"start":1753722425258,"stop":1753722425258,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dependencies_yml","time":{"start":1753722425259,"stop":1753722425259,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dependencies","time":{"start":1753722425259,"stop":1753722425259,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"selectors_yml","time":{"start":1753722425259,"stop":1753722425259,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"packages_yml","time":{"start":1753722425261,"stop":1753722425261,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_files","time":{"start":1753722425261,"stop":1753722425262,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"packages","time":{"start":1753722425261,"stop":1753722425261,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"is_firebolt_core","time":{"start":1753722425262,"stop":1753722425263,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project","time":{"start":1753722425262,"stop":1753722425262,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"seeds","time":{"start":1753722432538,"stop":1753722432538,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert \"CREATEFACTTA...der='Female')\" == \"CREATEDIMENS...der='Female')\"\n  - CREATEDIMENSIONTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\n  ?       ^^^^^^^^^\n  + CREATEFACTTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\n  ?       ^^^^","statusTrace":"self = <test_ephemeral.TestEphemeralMultiFirebolt object at 0x7fb624fadcd0>\nproject = <dbt.tests.fixtures.project.TestProjInfo object at 0x7fb621be3fd0>\nis_firebolt_core = False\n\n    def test_ephemeral_multi(self, project, is_firebolt_core):\n        run_dbt(['seed'])\n        results = run_dbt(['run'])\n        assert len(results) == 3\n    \n        check_relations_equal(project.adapter, ['seed', 'dependent'])\n        check_relations_equal(project.adapter, ['seed', 'double_dependent'])\n        check_relations_equal(project.adapter, ['seed', 'super_dependent'])\n        assert os.path.exists('./target/run/test/models/double_dependent.sql')\n        with open('./target/run/test/models/double_dependent.sql', 'r') as fp:\n            sql_file = fp.read()\n    \n        sql_file = re.sub(r'\\d+', '', sql_file)\n        table_type = 'DIMENSION' if not is_firebolt_core else 'FACT'\n        expected_sql = (\n            f'CREATE {table_type} TABLE IF NOT EXISTS double_dependent AS ('\n            'with __dbt__cte__base as ('\n            'select * from public.seed'\n            '),  __dbt__cte__base_copy as ('\n            'select * from __dbt__cte__base'\n            ')-- base_copy just pulls from base. Make sure the listed'\n            '-- graph of CTEs all share the same dbt_cte__base cte'\n            \"select * from __dbt__cte__base where gender = 'Male'\"\n            'union all'\n            \"select * from __dbt__cte__base_copy where gender = 'Female'\"\n            ')'\n        )\n        sql_file = ''.join(sql_file.split())\n        expected_sql = ''.join(expected_sql.split())\n>       assert sql_file == expected_sql\nE       assert \"CREATEFACTTA...der='Female')\" == \"CREATEDIMENS...der='Female')\"\nE         - CREATEDIMENSIONTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\nE         ?       ^^^^^^^^^\nE         + CREATEFACTTABLEIFNOTEXISTSdouble_dependentAS(with__dbt__cte__baseas(select*frompublic.seed),__dbt__cte__base_copyas(select*from__dbt__cte__base)--base_copyjustpullsfrombase.Makesurethelisted--graphofCTEsallsharethesamedbt_cte__basecteselect*from__dbt__cte__basewheregender='Male'unionallselect*from__dbt__cte__base_copywheregender='Female')\nE         ?       ^^^^\n\n/home/runner/work/dbt-firebolt/dbt-firebolt/tests/functional/adapter/test_ephemeral.py:85: AssertionError","steps":[],"attachments":[{"uid":"18447e86356e790","name":"log","source":"18447e86356e790.txt","type":"text/plain","size":32785},{"uid":"b4e22543178a7957","name":"stdout","source":"b4e22543178a7957.txt","type":"text/plain","size":2053},{"uid":"d2be47ae7a243ca1","name":"stderr","source":"d2be47ae7a243ca1.txt","type":"text/plain","size":28948}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"project_setup::0","time":{"start":1753722430280,"stop":1753722432235,"duration":1955},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"adapter::0","time":{"start":1753722432236,"stop":1753722432236,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logs_dir::0","time":{"start":1753722432237,"stop":1753722432237,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_yml::0","time":{"start":1753722432237,"stop":1753722432237,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.functional.adapter"},{"name":"suite","value":"test_ephemeral"},{"name":"subSuite","value":"TestEphemeralMultiFirebolt"},{"name":"host","value":"pkrvmpptgkbjq6m"},{"name":"thread","value":"2517-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.functional.adapter.test_ephemeral"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"84fe3b3f16eff415.json","parameterValues":[]}