{"uid":"995abd40eb02d214","name":"test__no_unique_keys","fullName":"tests.functional.adapter.incremental.test_incremental.TestUniqueKeyDeleteInsertFirebolt#test__no_unique_keys","historyId":"3f00210b5b7018c8ede9a147a6207aa7","time":{"start":1753380928158,"stop":1753380929741,"duration":1583},"description":"with no unique keys, seed and model should match","descriptionHtml":"<p>with no unique keys, seed and model should match</p>\n","status":"failed","statusMessage":"AssertionError: Got 2 different rows between seed and no_unique_key","statusTrace":"self = <test_incremental.TestUniqueKeyDeleteInsertFirebolt object at 0x7fb232f1c0a0>\nproject = <dbt.tests.fixtures.project.TestProjInfo object at 0x7fb22e7524a0>\n\n    def test__no_unique_keys(self, project):\n        \"\"\"with no unique keys, seed and model should match\"\"\"\n    \n        expected_fields = self.get_expected_fields(relation=\"seed\", seed_rows=9)\n        test_case_fields = self.get_test_fields(\n            project, seed=\"seed\", incremental_model=\"no_unique_key\", update_sql_file=\"add_new_rows\"\n        )\n>       self.check_scenario_correctness(expected_fields, test_case_fields, project)\n\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/adapter/incremental/test_incremental_unique_id.py:499: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/adapter/incremental/test_incremental_unique_id.py:411: in check_scenario_correctness\n    check_relations_equal(\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/util.py:407: in check_relations_equal\n    return check_relations_equal_with_relations(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nadapter = <dbt.adapters.firebolt.impl.FireboltAdapter object at 0x7fb22e678d30>\nrelations = [<FireboltRelation seed>, <FireboltRelation no_unique_key>]\ncompare_snapshot_cols = False\n\n    def check_relations_equal_with_relations(\n        adapter: Adapter, relations: List, compare_snapshot_cols=False\n    ):\n        with get_connection(adapter):\n            basis, compares = relations[0], relations[1:]\n            # Skip columns starting with \"dbt_\" because we don't want to\n            # compare those, since they are time sensitive\n            # (unless comparing \"dbt_\" snapshot columns is explicitly enabled)\n            column_names = [\n                c.name\n                for c in adapter.get_columns_in_relation(basis)  # type: ignore\n                if not c.name.lower().startswith(\"dbt_\") or compare_snapshot_cols\n            ]\n    \n            for relation in compares:\n                sql = adapter.get_rows_different_sql(basis, relation, column_names=column_names)  # type: ignore\n                _, tbl = adapter.execute(sql, fetch=True)\n                num_rows = len(tbl)\n                assert (\n                    num_rows == 1\n                ), f\"Invalid sql query from get_rows_different_sql: incorrect number of rows ({num_rows})\"\n                num_cols = len(tbl[0])\n                assert (\n                    num_cols == 2\n                ), f\"Invalid sql query from get_rows_different_sql: incorrect number of cols ({num_cols})\"\n                row_count_difference = tbl[0][0]\n                assert (\n                    row_count_difference == 0\n                ), f\"Got {row_count_difference} difference in row count betwen {basis} and {relation}\"\n                rows_mismatched = tbl[0][1]\n                assert (\n>                   rows_mismatched == 0\n                ), f\"Got {rows_mismatched} different rows between {basis} and {relation}\"\nE               AssertionError: Got 2 different rows between seed and no_unique_key\n\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/util.py:460: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"shared_data_dir","time":{"start":1753380777210,"stop":1753380777210,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmpdir_factory","time":{"start":1753380777211,"stop":1753380777211,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_data_dir","time":{"start":1753380918481,"stop":1753380918481,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"environment","time":{"start":1753380920515,"stop":1753380920515,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clean_up_logging","time":{"start":1753380920515,"stop":1753380920515,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_root","time":{"start":1753380920515,"stop":1753380920516,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"initialization","time":{"start":1753380920515,"stop":1753380920515,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_root","time":{"start":1753380920516,"stop":1753380920516,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"prefix","time":{"start":1753380920516,"stop":1753380920516,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"unique_schema","time":{"start":1753380920517,"stop":1753380920517,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_yml","time":{"start":1753380920517,"stop":1753380920518,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_config_update","time":{"start":1753380920517,"stop":1753380920517,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_profile_data","time":{"start":1753380920517,"stop":1753380920517,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_profile_target","time":{"start":1753380920517,"stop":1753380920517,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_config_update","time":{"start":1753380920518,"stop":1753380920518,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logs_dir","time":{"start":1753380920518,"stop":1753380920518,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dbt_project_yml","time":{"start":1753380920518,"stop":1753380920519,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"adapter","time":{"start":1753380920519,"stop":1753380920551,"duration":32},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_config","time":{"start":1753380920551,"stop":1753380920551,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_setup","time":{"start":1753380920552,"stop":1753380920610,"duration":58},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tests","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"macros","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"seeds","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"snapshots","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"analyses","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"models","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"properties","time":{"start":1753380920610,"stop":1753380920610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"selectors_yml","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"packages","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_files","time":{"start":1753380920611,"stop":1753380920612,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"packages_yml","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dependencies_yml","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"selectors","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dependencies","time":{"start":1753380920611,"stop":1753380920611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project","time":{"start":1753380920612,"stop":1753380920612,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clean_up","time":{"start":1753380928157,"stop":1753380928158,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_config_update","time":{"start":1753380941071,"stop":1753380941071,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"seeds","time":{"start":1753380941161,"stop":1753380941161,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"with no unique keys, seed and model should match","status":"failed","statusMessage":"AssertionError: Got 2 different rows between seed and no_unique_key","statusTrace":"self = <test_incremental.TestUniqueKeyDeleteInsertFirebolt object at 0x7fb232f1c0a0>\nproject = <dbt.tests.fixtures.project.TestProjInfo object at 0x7fb22e7524a0>\n\n    def test__no_unique_keys(self, project):\n        \"\"\"with no unique keys, seed and model should match\"\"\"\n    \n        expected_fields = self.get_expected_fields(relation=\"seed\", seed_rows=9)\n        test_case_fields = self.get_test_fields(\n            project, seed=\"seed\", incremental_model=\"no_unique_key\", update_sql_file=\"add_new_rows\"\n        )\n>       self.check_scenario_correctness(expected_fields, test_case_fields, project)\n\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/adapter/incremental/test_incremental_unique_id.py:499: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/adapter/incremental/test_incremental_unique_id.py:411: in check_scenario_correctness\n    check_relations_equal(\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/util.py:407: in check_relations_equal\n    return check_relations_equal_with_relations(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nadapter = <dbt.adapters.firebolt.impl.FireboltAdapter object at 0x7fb22e678d30>\nrelations = [<FireboltRelation seed>, <FireboltRelation no_unique_key>]\ncompare_snapshot_cols = False\n\n    def check_relations_equal_with_relations(\n        adapter: Adapter, relations: List, compare_snapshot_cols=False\n    ):\n        with get_connection(adapter):\n            basis, compares = relations[0], relations[1:]\n            # Skip columns starting with \"dbt_\" because we don't want to\n            # compare those, since they are time sensitive\n            # (unless comparing \"dbt_\" snapshot columns is explicitly enabled)\n            column_names = [\n                c.name\n                for c in adapter.get_columns_in_relation(basis)  # type: ignore\n                if not c.name.lower().startswith(\"dbt_\") or compare_snapshot_cols\n            ]\n    \n            for relation in compares:\n                sql = adapter.get_rows_different_sql(basis, relation, column_names=column_names)  # type: ignore\n                _, tbl = adapter.execute(sql, fetch=True)\n                num_rows = len(tbl)\n                assert (\n                    num_rows == 1\n                ), f\"Invalid sql query from get_rows_different_sql: incorrect number of rows ({num_rows})\"\n                num_cols = len(tbl[0])\n                assert (\n                    num_cols == 2\n                ), f\"Invalid sql query from get_rows_different_sql: incorrect number of cols ({num_cols})\"\n                row_count_difference = tbl[0][0]\n                assert (\n                    row_count_difference == 0\n                ), f\"Got {row_count_difference} difference in row count betwen {basis} and {relation}\"\n                rows_mismatched = tbl[0][1]\n                assert (\n>                   rows_mismatched == 0\n                ), f\"Got {rows_mismatched} different rows between {basis} and {relation}\"\nE               AssertionError: Got 2 different rows between seed and no_unique_key\n\n/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/dbt/tests/util.py:460: AssertionError","steps":[],"attachments":[{"uid":"e1a2b84bb00fc944","name":"log","source":"e1a2b84bb00fc944.txt","type":"text/plain","size":17187},{"uid":"de2164623f8e2cb7","name":"stdout","source":"de2164623f8e2cb7.txt","type":"text/plain","size":2290},{"uid":"a712845ed8d1ac8f","name":"stderr","source":"a712845ed8d1ac8f.txt","type":"text/plain","size":14376}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"clean_up::0","time":{"start":1753380929759,"stop":1753380930121,"duration":362},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"project_setup::0","time":{"start":1753380940714,"stop":1753380941054,"duration":340},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"adapter::0","time":{"start":1753380941055,"stop":1753380941055,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"profiles_yml::0","time":{"start":1753380941057,"stop":1753380941057,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"logs_dir::0","time":{"start":1753380941057,"stop":1753380941057,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"parentSuite","value":"tests.functional.adapter.incremental"},{"name":"suite","value":"test_incremental"},{"name":"subSuite","value":"TestUniqueKeyDeleteInsertFirebolt"},{"name":"host","value":"pkrvmpptgkbjq6m"},{"name":"thread","value":"4681-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.functional.adapter.incremental.test_incremental"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"995abd40eb02d214.json","parameterValues":[]}